function t(t){return"text"===t.type?t.value:"children"in t?n(t):""}function n(n){let e=-1;const r=[];for(;++e<n.children.length;)r[e]=t(n.children[e]);return r.join("")}const e=function(t){if(null==t)return o;if("function"==typeof t)return r(t);if("object"==typeof t)return Array.isArray(t)?function(t){const n=[];let o=-1;for(;++o<t.length;)n[o]=e(t[o]);return r((function(...t){let e=-1;for(;++e<n.length;)if(n[e].apply(this,t))return 1;return 0}))}(t):(t=>{const n=t;return r((e=>{const r=e;let o;for(o in t)if(r[o]!==n[o])return 0;return 1}))})(t);if("string"==typeof t)return n=t,r((t=>t&&t.type===n));var n;throw Error("Expected function, string, or object as test")};function r(t){return function(n,e,r){return!(!(t=>null!==t&&"object"==typeof t&&"type"in t)(n)||!t.call(this,n,"number"==typeof e?e:void 0,r||void 0))}}function o(){return 1}const i=[],c="language-";function u(t,r){const o=t.getLoadedLanguages(),{addLanguageClass:u=0,parseMetaString:f,cache:s,defaultLanguage:a,fallbackLanguage:l,onError:p,...y}=r;return function(r){((t,n,r,o)=>{let c,u,f;u="element",f=r,c=void 0,((t,n,r,o)=>{let c;c=n;const u=e(c),f=o?-1:1;!function t(n,e,c){const s=n&&"object"==typeof n?n:{};if("string"==typeof s.type){const t="string"==typeof s.tagName?s.tagName:"string"==typeof s.name?s.name:void 0;Object.defineProperty(a,"name",{value:"node ("+n.type+(t?"<"+t+">":"")+")"})}return a;function a(){let s,a,l,p=i;if(u(n,e,c[c.length-1]||void 0)&&(p=(t=>Array.isArray(t)?t:"number"==typeof t?[1,t]:null==t?i:[t])(r(n,c)),0===p[0]))return p;if("children"in n&&n.children){const e=n;if(e.children&&"skip"!==p[0])for(a=(o?e.children.length:-1)+f,l=c.concat(e);a>-1&&e.children.length>a;){if(s=t(e.children[a],a,l)(),0===s[0])return s;a="number"==typeof s[1]?s[1]:a+f}}return p}}(t,void 0,[])()})(t,"element",((t,n)=>{const e=n[n.length-1],r=e?e.children.indexOf(t):void 0;return f(t,r,e)}),void 0)})(r,0,((e,i,d)=>{if(!d||null==i||"pre"!==e.tagName)return;const g=e.children[0];if(!g||"element"!==g.type||"code"!==g.tagName||!g.properties)return;const h=g.properties.className,m=Array.isArray(h)?h.find((t=>"string"==typeof t&&t.startsWith(c))):void 0;let v="string"==typeof m?m.slice(9):a;if(!v)return;l&&!o.includes(v)&&(v=l);const b=(t=>"children"in t?n(t):"value"in t?t.value:"")(g),j=s?.get(b);if(j)return void d.children.splice(i,1,...j);const k=g.data?.meta??g.properties.metastring?.toString()??"",w=f?.(k,e,r)||{},x={...y,lang:v,meta:{...y.meta,...w,__raw:k}};u&&(x.transformers||(x.transformers=[]),x.transformers.push({name:"rehype-shiki:code-language-class",code(t){return this.addClassToHast(t,`${c}${v}`),t}}));try{const n=t.codeToHast(b,x);s?.set(b,n.children),d.children.splice(i,1,...n.children)}catch(t){if(!p)throw t;p(t)}}))}}const f=t=>({transformers:[{execution:"async",type:"rehype",async transform({processor:n,carta:e}){let r=t?.theme;const o=await e.highlighter();o&&(r||(r=o.theme),(t=>!(t=>"object"==typeof t&&"light"in t&&"dark"in t)(t))(r)?n.use(u,o,{...t,theme:r}):n.use(u,o,{...t,themes:r}))}}]});export{f as default};
