var CartaMd=function(){function t(t){return"text"===t.type?t.value:"children"in t?n(t):""}function n(n){let e=-1;const r=[];for(;++e<n.children.length;)r[e]=t(n.children[e]);return r.join("")}const e=function(t){if(null==t)return o;if("function"==typeof t)return r(t);if("object"==typeof t)return Array.isArray(t)?function(t){const n=[];let o=-1;for(;++o<t.length;)n[o]=e(t[o]);return r((function(...t){let e=-1;for(;++e<n.length;)if(n[e].apply(this,t))return 1;return 0}))}(t):(t=>{const n=t;return r((e=>{const r=e;let o;for(o in t)if(r[o]!==n[o])return 0;return 1}))})(t);if("string"==typeof t)return n=t,r((t=>t&&t.type===n));var n;throw Error("Expected function, string, or object as test")};function r(t){return function(n,e,r){return!(!(t=>null!==t&&"object"==typeof t&&"type"in t)(n)||!t.call(this,n,"number"==typeof e?e:void 0,r||void 0))}}function o(){return 1}const i=[],u="language-";function c(t,r){const o=t.getLoadedLanguages(),{addLanguageClass:c=0,parseMetaString:f,cache:s,defaultLanguage:a,fallbackLanguage:l,onError:y,...d}=r;return function(r){((t,n,r,o)=>{let u,c,f;c="element",f=r,u=void 0,((t,n,r,o)=>{let u;u=n;const c=e(u),f=o?-1:1;!function t(n,e,u){const s=n&&"object"==typeof n?n:{};if("string"==typeof s.type){const t="string"==typeof s.tagName?s.tagName:"string"==typeof s.name?s.name:void 0;Object.defineProperty(a,"name",{value:"node ("+n.type+(t?"<"+t+">":"")+")"})}return a;function a(){let s,a,l,y=i;if(c(n,e,u[u.length-1]||void 0)&&(y=(t=>Array.isArray(t)?t:"number"==typeof t?[1,t]:null==t?i:[t])(r(n,u)),0===y[0]))return y;if("children"in n&&n.children){const e=n;if(e.children&&"skip"!==y[0])for(a=(o?e.children.length:-1)+f,l=u.concat(e);a>-1&&e.children.length>a;){if(s=t(e.children[a],a,l)(),0===s[0])return s;a="number"==typeof s[1]?s[1]:a+f}}return y}}(t,void 0,[])()})(t,"element",((t,n)=>{const e=n[n.length-1],r=e?e.children.indexOf(t):void 0;return f(t,r,e)}),void 0)})(r,0,((e,i,p)=>{if(!p||null==i||"pre"!==e.tagName)return;const g=e.children[0];if(!g||"element"!==g.type||"code"!==g.tagName||!g.properties)return;const h=g.properties.className,v=Array.isArray(h)?h.find((t=>"string"==typeof t&&t.startsWith(u))):void 0;let m="string"==typeof v?v.slice(9):a;if(!m)return;l&&!o.includes(m)&&(m=l);const b=(t=>"children"in t?n(t):"value"in t?t.value:"")(g),j=s?.get(b);if(j)return void p.children.splice(i,1,...j);const k=g.data?.meta??g.properties.metastring?.toString()??"",w=f?.(k,e,r)||{},x={...d,lang:m,meta:{...d.meta,...w,__raw:k}};c&&(x.transformers||(x.transformers=[]),x.transformers.push({name:"rehype-shiki:code-language-class",code(t){return this.addClassToHast(t,`${u}${m}`),t}}));try{const n=t.codeToHast(b,x);s?.set(b,n.children),p.children.splice(i,1,...n.children)}catch(t){if(!y)throw t;y(t)}}))}}return t=>({transformers:[{execution:"async",type:"rehype",async transform({processor:n,carta:e}){let r=t?.theme;const o=await e.highlighter();r||(r=o.theme),(t=>!(t=>"object"==typeof t&&"light"in t&&"dark"in t)(t))(r)?n.use(c,o,{...t,theme:r}):n.use(c,o,{...t,themes:r})}}]})}();
