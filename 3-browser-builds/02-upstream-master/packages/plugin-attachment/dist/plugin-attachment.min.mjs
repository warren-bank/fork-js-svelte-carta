function n(){}function t(n){return n()}function o(n){n.forEach(t)}function e(n){return"function"==typeof n}function r(n,t){return n!=n?t==t:n!==t}function i(t,...o){if(null==t){for(const n of o)n(void 0);return n}const e=t.subscribe(...o);return e.unsubscribe?()=>e.unsubscribe():e}function c(n){let t;return i(n,(n=>t=n))(),t}function l(n,t){n.appendChild(t)}function u(n,t,o){n.insertBefore(t,o||null)}function s(n){n.parentNode&&n.parentNode.removeChild(n)}function a(n){return document.createElement(n)}function f(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function d(n){return document.createTextNode(n)}function p(){return d("")}function g(n,t,o,e){return n.addEventListener(t,o,e),()=>n.removeEventListener(t,o,e)}function v(n,t,o){null==o?n.removeAttribute(t):n.getAttribute(t)!==o&&n.setAttribute(t,o)}function h(n,t){n.data!==(t=""+t)&&(n.data=t)}function m(n,t){return new n(t)}let w;function y(n){w=n}function O(n,t){const o=n.l.t[t.type];o&&o.slice().forEach((n=>n.call(this,t)))}const x=[],b=[];let $=[];const _=[],A=Promise.resolve();let S=0;function T(n){$.push(n)}const D=new Set;let F=0;function k(){if(0!==F)return;const n=w;do{try{for(;x.length>F;){const n=x[F];F++,y(n),C(n.l)}}catch(n){throw x.length=0,F=0,n}for(y(null),x.length=0,F=0;b.length;)b.pop()();for(let n=0;$.length>n;n+=1){const t=$[n];D.has(t)||(D.add(t),t())}$.length=0}while(x.length);for(;_.length;)_.pop()();S=0,D.clear(),y(n)}function C(n){if(null!==n.fragment){n.update(),o(n.u);const t=n.h;n.h=[-1],n.fragment&&n.fragment.p(n.O,t),n.$.forEach(T)}}const L=new Set;let M;function j(){M={r:0,c:[],p:M}}function B(){M.r||o(M.c),M=M.p}function H(n,t){n&&n.i&&(L.delete(n),n.i(t))}function Z(n,t,o,e){if(n&&n.o){if(L.has(n))return;L.add(n),M.c.push((()=>{L.delete(n),e&&(o&&n.d(1),e())})),n.o(t)}else e&&e()}function z(n){n&&n.c()}function q(n,r,i){const{fragment:c,$:l}=n.l;c&&c.m(r,i),T((()=>{const r=n.l._.map(t).filter(e);n.l.A?n.l.A.push(...r):o(r),n.l._=[]})),l.forEach(T)}function P(n,t){const e=n.l;null!==e.fragment&&((n=>{const t=[],o=[];$.forEach((e=>-1===n.indexOf(e)?t.push(e):o.push(e))),o.forEach((n=>n())),$=t})(e.$),o(e.A),e.fragment&&e.fragment.d(t),e.A=e.fragment=null,e.O=[])}function U(t,e,r,i,c,l,u=null,s=[-1]){const a=w;y(t);const f=t.l={fragment:null,O:[],S:l,update:n,T:c,bound:{},_:[],A:[],D:[],u:[],$:[],context:new Map(e.context||(a?a.l.context:[])),t:{},h:s,F:0,root:e.target||a.l.root};u&&u(f.root);let d=0;f.O=r?r(t,e.S||{},((n,o,...e)=>{const r=e.length?e[0]:o;return f.O&&c(f.O[n],f.O[n]=r)&&(!f.F&&f.bound[n]&&f.bound[n](r),d&&((n,t)=>{-1===n.l.h[0]&&(x.push(n),S||(S=1,A.then(k)),n.l.h.fill(0)),n.l.h[t/31|0]|=1<<t%31})(t,n)),o})):[],f.update(),d=1,o(f.u),f.fragment=i?i(f.O):0,e.target&&(f.fragment&&f.fragment.c(),q(t,e.target,e.anchor),k()),y(a)}class E{l=void 0;k=void 0;$destroy(){P(this,1),this.$destroy=n}$on(t,o){if(!e(o))return n;const r=this.l.t[t]||(this.l.t[t]=[]);return r.push(o),()=>{const n=r.indexOf(o);-1!==n&&r.splice(n,1)}}C(n){this.k&&0!==Object.keys(n).length&&(this.l.F=1,this.k(n),this.l.F=0)}}const G=[];function I(t,o=n){let e;const r=new Set;function i(n){if(i=n,((o=t)!=o?i==i:o!==i||o&&"object"==typeof o||"function"==typeof o)&&(t=n,e)){const n=!G.length;for(const n of r)n[1](),G.push(n,t);if(n){for(let n=0;G.length>n;n+=2)G[n][0](G[n+1]);G.length=0}}var o,i}function c(n){i(n(t))}return{set:i,update:c,subscribe(l,u=n){const s=[l,u];return r.add(s),1===r.size&&(e=o(i,c)||n),l(t),()=>{r.delete(s),0===r.size&&e&&(e(),e=null)}}}}function J(t){let o,e;return{c(){o=f("svg"),e=f("path"),v(e,"fill","currentColor"),v(e,"d","M10 16h4c.55 0 1-.45 1-1v-5h1.59c.89 0 1.34-1.08.71-1.71L12.71 3.7a.996.996 0 0 0-1.41 0L6.71 8.29c-.63.63-.19 1.71.7 1.71H9v5c0 .55.45 1 1 1zm-4 2h12c.55 0 1 .45 1 1s-.45 1-1 1H6c-.55 0-1-.45-1-1s.45-1 1-1z"),v(o,"class","upload-icon"),v(o,"xmlns","http://www.w3.org/2000/svg"),v(o,"width","24"),v(o,"height","24"),v(o,"viewBox","0 0 24 24")},m(n,t){u(n,o,t),l(o,e)},p:n,i:n,o:n,d(n){n&&s(o)}}}(globalThis._bp||(globalThis._bp={v:new Set})).v.add("4");class K extends E{constructor(n){super(),U(this,n,null,J,r,{})}}function N(n){let t,r,i,c,l,f;const d=[R,Q],p=[];function h(n,t){return n[3]?0:1}return r=h(n),i=p[r]=d[r](n),{c(){t=a("div"),i.c(),v(t,"class","carta-drop-overlay"),v(t,"role","button"),v(t,"tabindex","0"),v(t,"aria-label","Drop files to upload")},m(o,i){var s;u(o,t,i),p[r].m(t,null),c=1,l||(f=[g(t,"dragover",(s=n[7],function(n){return n.preventDefault(),s.call(this,n)})),g(t,"dragenter",n[8]),g(t,"dragleave",n[9]),g(t,"drop",(function(){e(n[2])&&n[2].apply(this,arguments)}))],l=1)},p(o,e){let c=r;r=h(n=o),r===c?p[r].p(n,e):(j(),Z(p[c],1,1,(()=>{p[c]=null})),B(),i=p[r],i?i.p(n,e):(i=p[r]=d[r](n),i.c()),H(i,1),i.m(t,null))},i(n){c||(H(i),c=1)},o(n){Z(i),c=0},d(n){n&&s(t),p[r].d(),l=0,o(f)}}}function Q(t){let o,e,r,i;return r=new K({}),{c(){o=a("div"),e=a("div"),z(r.l.fragment),v(e,"class","carta-drop-overlay-content"),v(o,"class","carta-drop-overlay-container")},m(n,t){u(n,o,t),l(o,e),q(r,e,null),i=1},p:n,i(n){i||(H(r.l.fragment,n),i=1)},o(n){Z(r.l.fragment,n),i=0},d(n){n&&s(o),P(r)}}}function R(n){let t,o,e;var r=n[3];return r&&(t=m(r,{})),{c(){t&&z(t.l.fragment),o=p()},m(n,r){t&&q(t,n,r),u(n,o,r),e=1},p(n,e){if(8&e&&r!==(r=n[3])){if(t){j();const n=t;Z(n.l.fragment,1,0,(()=>{P(n,1)})),B()}r?(t=m(r,{}),z(t.l.fragment),H(t.l.fragment,1),q(t,o.parentNode,o)):t=null}},i(n){e||(t&&H(t.l.fragment,n),e=1)},o(n){t&&Z(t.l.fragment,n),e=0},d(n){n&&s(o),t&&P(t,n)}}}function V(n){let t,o,e=0!=n[3]&&(n[4]||n[5])&&N(n);return{c(){e&&e.c(),t=p()},m(n,r){e&&e.m(n,r),u(n,t,r),o=1},p(n,[o]){0!=n[3]&&(n[4]||n[5])?e?(e.p(n,o),56&o&&H(e,1)):(e=N(n),e.c(),H(e,1),e.m(t.parentNode,t)):e&&(j(),Z(e,1,1,(()=>{e=null})),B())},i(n){o||(H(e),o=1)},o(n){Z(e),o=0},d(n){n&&s(t),e&&e.d(n)}}}function W(t,o,e){let r,c,l=n,u=()=>(l(),l=i(d,(n=>e(4,r=n))),d),s=n,a=()=>(s(),s=i(p,(n=>e(5,c=n))),p);t.l.A.push((()=>l())),t.l.A.push((()=>s()));let{carta:f}=o,{draggingOverTextArea:d}=o;u();let{draggingOverOverlay:p}=o;a();let{handleDrop:g}=o,{dropOverlay:v}=o;return t.k=n=>{"carta"in n&&e(6,f=n.carta),"draggingOverTextArea"in n&&u(e(0,d=n.draggingOverTextArea)),"draggingOverOverlay"in n&&a(e(1,p=n.draggingOverOverlay)),"handleDrop"in n&&e(2,g=n.handleDrop),"dropOverlay"in n&&e(3,v=n.dropOverlay)},[d,p,g,v,r,c,f,function(n){O.call(this,t,n)},()=>p.set(1),()=>p.set(0)]}class X extends E{constructor(n){super(),U(this,n,W,V,r,{carta:6,draggingOverTextArea:0,draggingOverOverlay:1,handleDrop:2,dropOverlay:3})}}function Y(t){let o,e;return{c(){o=f("svg"),e=f("path"),v(e,"fill","none"),v(e,"stroke","currentColor"),v(e,"stroke-width","2"),v(e,"d","m22 12l-9 9c-6 6-15-3-9-9l9-9c4-4 10 2 6 6l-9 9c-2 2-5-1-3-3l9-9"),v(o,"class","attach-icon"),v(o,"xmlns","http://www.w3.org/2000/svg"),v(o,"width","16"),v(o,"height","16"),v(o,"viewBox","0 0 24 24")},m(n,t){u(n,o,t),l(o,e)},p:n,i:n,o:n,d(n){n&&s(o)}}}class nn extends E{constructor(n){super(),U(this,n,null,Y,r,{})}}function tn(t){let o,e,r,i;return{c(){o=f("svg"),e=f("g"),r=f("path"),i=f("path"),v(r,"fill-rule","evenodd"),v(r,"d","M12 19a7 7 0 1 0 0-14a7 7 0 0 0 0 14Zm0 3c5.523 0 10-4.477 10-10S17.523 2 12 2S2 6.477 2 12s4.477 10 10 10Z"),v(r,"clip-rule","evenodd"),v(r,"opacity",".2"),v(i,"d","M2 12C2 6.477 6.477 2 12 2v3a7 7 0 0 0-7 7H2Z"),v(e,"fill","currentColor"),v(o,"class","spinner-icon"),v(o,"xmlns","http://www.w3.org/2000/svg"),v(o,"width","24"),v(o,"height","24"),v(o,"viewBox","0 0 24 24")},m(n,t){u(n,o,t),l(o,e),l(e,r),l(e,i)},p:n,i:n,o:n,d(n){n&&s(o)}}}class on extends E{constructor(n){super(),U(this,n,null,tn,r,{})}}function en(n){let t,o,e,r;const i=[cn,rn],c=[];function l(n,t){return n[1]?0:n[2].length>0?1:-1}return~(t=l(n))&&(o=c[t]=i[t](n)),{c(){o&&o.c(),e=p()},m(n,o){~t&&c[t].m(n,o),u(n,e,o),r=1},p(n,r){let u=t;t=l(n),t===u?~t&&c[t].p(n,r):(o&&(j(),Z(c[u],1,1,(()=>{c[u]=null})),B()),~t?(o=c[t],o?o.p(n,r):(o=c[t]=i[t](n),o.c()),H(o,1),o.m(e.parentNode,e)):o=null)},i(n){r||(H(o),r=1)},o(n){Z(o),r=0},d(n){n&&s(e),~t&&c[t].d(n)}}}function rn(n){let t,o,e,r,i,c,f,p,g=n[2].length+"",m=n[2].length>1?"s":"";return o=new on({}),{c(){t=a("div"),z(o.l.fragment),e=a("span"),r=d("Loading "),i=d(g),c=d(" file"),f=d(m),v(t,"class","carta-loading-overlay")},m(n,s){u(n,t,s),q(o,t,null),l(t,e),l(e,r),l(e,i),l(e,c),l(e,f),p=1},p(n,t){(!p||4&t)&&g!==(g=n[2].length+"")&&h(i,g),(!p||4&t)&&m!==(m=n[2].length>1?"s":"")&&h(f,m)},i(n){p||(H(o.l.fragment,n),p=1)},o(n){Z(o.l.fragment,n),p=0},d(n){n&&s(t),P(o)}}}function cn(n){let t,o,e;var r=n[1];function i(n,t){return{S:{uploadingFiles:n[2]}}}return r&&(t=m(r,i(n))),{c(){t&&z(t.l.fragment),o=p()},m(n,r){t&&q(t,n,r),u(n,o,r),e=1},p(n,e){if(2&e&&r!==(r=n[1])){if(t){j();const n=t;Z(n.l.fragment,1,0,(()=>{P(n,1)})),B()}r?(t=m(r,i(n)),z(t.l.fragment),H(t.l.fragment,1),q(t,o.parentNode,o)):t=null}else if(r){const o={};4&e&&(o.uploadingFiles=n[2]),t.C(o)}},i(n){e||(t&&H(t.l.fragment,n),e=1)},o(n){t&&Z(t.l.fragment,n),e=0},d(n){n&&s(o),t&&P(t,n)}}}function ln(n){let t,o,e=0!=n[1]&&en(n);return{c(){e&&e.c(),t=p()},m(n,r){e&&e.m(n,r),u(n,t,r),o=1},p(n,[o]){0!=n[1]?e?(e.p(n,o),2&o&&H(e,1)):(e=en(n),e.c(),H(e,1),e.m(t.parentNode,t)):e&&(j(),Z(e,1,1,(()=>{e=null})),B())},i(n){o||(H(e),o=1)},o(n){Z(e),o=0},d(n){n&&s(t),e&&e.d(n)}}}function un(t,o,e){let r,c=n,l=()=>(c(),c=i(s,(n=>e(2,r=n))),s);t.l.A.push((()=>c()));let{carta:u}=o,{uploadingFiles:s}=o;l();let{loadingOverlay:a}=o;return t.k=n=>{"carta"in n&&e(3,u=n.carta),"uploadingFiles"in n&&l(e(0,s=n.uploadingFiles)),"loadingOverlay"in n&&e(1,a=n.loadingOverlay)},[s,a,r,u]}class sn extends E{constructor(n){super(),U(this,n,un,ln,r,{carta:3,uploadingFiles:0,loadingOverlay:1})}}const an=["image/png","image/jpeg","image/gif","image/svg+xml"],fn=n=>{let t;const o=n.supportedMimeTypes||an,e=I(0),r=I(0),i=I([]),l=I(0);async function u(e){if(!o.includes(e.type))return;if(!t?.input)return;const r=t.input.textarea,c=`[Uploading ${e.name}](loading)`;t.input.insertAt(t.input.textarea.selectionStart,c),t.input.update(),i.update((n=>[...n,e]));const l=await n.upload(e);i.update((n=>n.filter((n=>n!==e))));const u=t.input.textarea.value.indexOf(c);if(-1!==u&&t.input.removeAt(u,c.length),t.input.update(),!l)return;const s=an.includes(e.type)?`![${e.name}](${l})`:`[${e.name}](${l})`;t.input.insertAt(u,s),t.input.update(),t.input.history.saveState(r.value,r.selectionStart)}function s(n){n.preventDefault(),r.set(0),e.set(0);const t=n.dataTransfer?.files;if(t)for(const n of t)u(n)}return e.subscribe((n=>l.set(n||c(r)))),r.subscribe((n=>l.set(n||c(e)))),l.subscribe((n=>{t&&t.element&&(n?t.element.classList.add("dragging-attachment"):t.element.classList.remove("dragging-attachment"))})),{onLoad({carta:n}){t=n},listeners:[["drop",s,0],["dragenter",()=>e.set(1)],["dragleave",()=>e.set(0)],["dragover",n=>n.preventDefault()],["paste",n=>{const t=n.clipboardData?.items;if(!t)return;const o=Array.from(t);for(const t of o)if("file"===t.kind){const o=t.getAsFile();if(!o)continue;n.preventDefault(),u(o)}},0]],components:[{component:X,S:{draggingOverTextArea:e,draggingOverOverlay:r,handleDrop:s,dropOverlay:n.dropOverlay},parent:"input"},{component:sn,S:{uploadingFiles:i,loadingOverlay:n.loadingOverlay},parent:"input"}],icons:n.disableIcon?[]:[{component:nn,action(){const n=document.createElement("input");n.type="file",n.multiple=1,n.accept=o.join(", "),n.onchange=n=>{const t=n.target?.files;if(t)for(const n of t)u(n)},n.click()},id:"attach",label:"Attach file"}]}};export{fn as default};
